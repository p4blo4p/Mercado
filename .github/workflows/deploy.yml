name: 1. Deploy from Zip

on:
  workflow_dispatch: # BotÃ³n manual
  push:
    paths:
      - '**.zip' # Se activa automÃ¡ticamente si subes un ZIP

jobs:
  unzip-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Unzip Source
        run: |
          # Busca cualquier archivo .zip en la raÃ­z
          if ls *.zip 1> /dev/null 2>&1; then
            echo "ğŸ“¦ ZIP detectado. Descomprimiendo..."
            unzip -o *.zip -d .
            
            # Si el zip creÃ³ una subcarpeta (ej: Mercado-main/), sacar archivos a la raÃ­z
            if [ -d "Mercado-main" ]; then
              cp -r Mercado-main/* .
              rm -rf Mercado-main
            fi

            # Limpieza
            echo "ğŸ—‘ï¸ Eliminando ZIP original..."
            rm *.zip
            
            # Configurar git para guardar los cambios
            git config --global user.name 'GitHub Action'
            git config --global user.email 'action@github.com'
            git add .
            git commit -m "Deploy: Unzipped source files"
            git push
          else
            echo "âœ… No se encontrÃ³ archivo .zip. Nada que hacer."
          fi
